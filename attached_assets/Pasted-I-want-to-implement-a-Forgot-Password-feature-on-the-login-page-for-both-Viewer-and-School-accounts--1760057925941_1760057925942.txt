I want to implement a Forgot Password feature on the login page for both Viewer and School accounts.
This should use the same secure flow as the in-app password change system already being implemented, but be accessible for users who can’t log in.


---

⚙️ 1️⃣ Login Page Update (Frontend)

On the /login page:

Add a small link or text button below the login form:

> “Forgot your password?”



When clicked:

Open a small modal OR redirect to a dedicated page: /forgot-password

The form should contain a single input:

Email address

Button: “Send Reset Link”





---

📧 2️⃣ Request Handling (Backend)

Use the same endpoint as the in-app version: POST /api/auth/request-password-reset

Accept the provided email.

If the email exists in the database, send the password reset email with a secure token.

If it doesn’t exist, still respond with a success message (for security — don’t reveal if the email is registered).


Example success message:

> “If this email is associated with a Waibuk account, you’ll receive a password reset link shortly.”




---

📬 3️⃣ Reset Email (via Resend)

Use the same Resend setup as before, with sandbox mode for now.

Email contents:

Subject: Reset Your Waibuk Password

Body:

> “We received a request to reset your password. Click below to choose a new one.”



Button: → https://your-domain.com/reset-password/:token


The token and expiration logic are the same as before:

Token valid for 30 minutes

Stored securely (hashed)

One-time use



---

🔑 4️⃣ Reset Password Page (Frontend)

Same as the one created in the previous prompt:

URL: /reset-password/:token

Fields:

New Password

Confirm Password


Validate both fields match before sending request.


Submit to: POST /api/auth/reset-password

If successful:

> “Your password has been successfully reset! You can now log in with your new password.”



If invalid/expired:

> “This link has expired or is invalid. Please request another reset link.”




---

💾 5️⃣ Backend Integration

Use the same backend functions from the previous prompt:

request-password-reset to create token and send email

reset-password to verify and update password


If necessary, make sure these work for both Viewer and School accounts by checking role or table source.


---

🔒 6️⃣ Security Safeguards

Tokens expire after 30 minutes.

After successful reset, delete or invalidate token.

Send a confirmation email:

> “Your Waibuk password was successfully changed. If this wasn’t you, please contact support.”



All user responses should be generic — never reveal whether an email exists.



---

✅ 7️⃣ UX Details

On successful reset, automatically redirect users to /login after 3–5 seconds with a success message banner.

Keep design consistent with the rest of your app (use same card style, font, and button design).



---

🧩 Goal: Make it possible for both Viewer and School accounts to recover access securely if they forget their password, using the same backend as the in-app password change system — just triggered from the login page.
