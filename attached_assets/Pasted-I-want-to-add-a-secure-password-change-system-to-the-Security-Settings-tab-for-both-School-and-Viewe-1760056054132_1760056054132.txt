I want to add a secure password change system to the Security Settings tab for both School and Viewer accounts.

The flow should be identical to how modern platforms like Instagram or GitHub handle it â€” with email verification before changing the password.


---

âš™ï¸ 1ï¸âƒ£ User Flow (Frontend)

Inside the Security Settings card:

Add a â€œChange Passwordâ€ section with a button labeled â€œRequest Password Changeâ€.

When clicked:

The system sends a password reset email to the accountâ€™s registered email address.

Display a small info message like:

> â€œWeâ€™ve sent a password reset link to your email. Please check your inbox to continue.â€






---

ğŸ“§ 2ï¸âƒ£ Email Sending (Backend)

Use the same Resend setup already implemented for email verification.

Subject: Reset Your Waibuk Password

From: onboarding@resend.dev (or your verified domain email when available)

Email content should include:

A message like:

> â€œWe received a request to change your password for your Waibuk account. Click the button below to continue.â€



A button or link that takes them to a dedicated Reset Password page, e.g.:

https://your-domain.com/reset-password/:token

The token should be a secure, temporary code stored in the database with:

user_id

token

expires_at (e.g. 30 minutes validity)





---

ğŸ”’ 3ï¸âƒ£ Password Reset Page (Frontend)

The page /reset-password/:token should:

Verify the token with the backend.

If valid, display a form:

New Password

Confirm Password

Submit button


If invalid or expired, show a message:

> â€œThis reset link is invalid or has expired. Please request a new one.â€






---

ğŸ§  4ï¸âƒ£ Backend Logic

Create a new API route:
POST /api/auth/request-password-reset
â†’ Accepts email, generates token, stores it in password_reset_tokens table, and sends email.

Another route:
POST /api/auth/reset-password
â†’ Accepts { token, newPassword }
â†’ Validates token and expiry â†’ Updates the userâ€™s password (hash with bcrypt) â†’ Deletes or invalidates the token after use.



---

ğŸ’½ 5ï¸âƒ£ Database

Create a new table (or Drizzle schema):

password_reset_tokens: {
  id: uuid,
  user_id: uuid (foreign key),
  token: string,
  expires_at: timestamp,
  created_at: timestamp
}


---

ğŸ§© 6ï¸âƒ£ Security & Usability Notes

Hash all tokens before storing (never store raw tokens).

Tokens expire automatically after 30 minutes.

After successful password reset, send a confirmation email:

> â€œYour Waibuk password was successfully changed. If you didnâ€™t make this change, contact support immediately.â€



Prevent reuse of expired tokens.

For consistency, use the same Resend sandbox setup for testing until the domain is verified.



---

âœ… 7ï¸âƒ£ Frontend Placement

Add this system to the Security tab in both:

/viewer-settings/security

/school-settings/security


The UI design should match existing app cards â€” clean, consistent, and responsive.



---

ğŸ§© Goal:
Allow users (both school and viewer) to securely change their password through email verification, ensuring the process is smooth, modern, and safe â€” exactly how top-tier web apps do it.